# =============================================================================
# Auto-generated by Network Security Policy-as-Code
# Policy: allow-web-to-api
# Ticket: SNOW-12345
# Requestor: john.smith@company.com
# Scope: pce-prod
# =============================================================================

# Supporting Resources

data "illumio-core_labels" "label_web_tier_app" {
  key   = "app"
  value = "web-tier"
}


data "illumio-core_labels" "label_web_tier_env" {
  key   = "env"
  value = "production"
}


data "illumio-core_labels" "label_api_tier_app" {
  key   = "app"
  value = "api-tier"
}


data "illumio-core_labels" "label_api_tier_env" {
  key   = "env"
  value = "production"
}

# Policy Resources

resource "illumio-core_rule_set" "allow_web_to_api" {
  name        = "allow-web-to-api"
  description = "Allow web tier to communicate with API tier on HTTPS - SNOW-12345"
  enabled     = true

  scopes {
    # Define scope based on PCE organization
  }

  rule {
    enabled                         = true
    description                     = "Allow web tier to communicate with API tier on HTTPS"
    resolve_labels_as_workloads     = true
    

    providers {
      label {
        href = data.illumio-core_labels.label_api_tier_app.items[0].href
      }
    }


    consumers {
      label {
        href = data.illumio-core_labels.label_web_tier_app.items[0].href
      }
    }


      ingress_services {
        proto = 6
        port  = 443
      }
  }
}
